# v4 to v5 Migration Cleanup Guide

This guide lists the **specific files** that were auto-generated by sqlew v4 (`sqlew --init`, `sqlew --hooks`). Delete only these files - other files in the same directories may have been created by you or other tools.

## What Changed in v5

| Feature | v4 (Legacy) | v5 (Plugin) |
|---------|-------------|-------------|
| Installation | `sqlew --init` per project | `sqlew-plugin` via Claude Plugin marketplace |
| Skills/Hooks | `.claude/hooks/`, `.claude/skills/` | Managed by plugin |
| Agents | `.claude/agents/` | Removed (Agent system deprecated) |
| Rules | `.claude/rules/` | Global `~/.claude/rules/sqlew/` |
| Commands | `.claude/commands/` | Global `~/.claude/commands/` |

---

## Files to Delete (v4 Auto-Generated)

### Agents (Added by sqlew v3.x, deprecated in v4.0.0)

These agent definition files were created by early sqlew versions:

| File | Description |
|------|-------------|
| `.claude/agents/parallel-orchestrator.md` | Parallel task orchestration agent |
| `.claude/agents/sqlew-architect.md` | Architecture decision agent |
| `.claude/agents/sqlew-researcher.md` | Context research agent |
| `.claude/agents/sqlew-scrum-master.md` | Task management agent |

### Commands (Added by `sqlew --init`)

| File | Description |
|------|-------------|
| `.claude/commands/sqlew.md` | `/sqlew` slash command definition |

**Note**: Now managed globally at `~/.claude/commands/sqlew.md` by the plugin.

### Hooks (Added by `sqlew --hooks`)

| File | Description |
|------|-------------|
| `.claude/hooks/check-ast-grep.mjs` | AST pattern validation hook |
| `.claude/hooks/check-db-path.mjs` | Database path guardrail hook |
| `.claude/hooks/check-migration.mjs` | Migration file protection hook |
| `.claude/hooks/check-prod-db.mjs` | Production DB protection hook |

**Note**: Now managed by sqlew-plugin.

### Rules (Added by `sqlew --init`)

| File | Description |
|------|-------------|
| `.claude/rules/plan-mode-integration.md` | Plan mode decision format guide |

**Note**: Now managed globally at `~/.claude/rules/sqlew/plan-mode-integration.md`.

### Skills (Added by `sqlew --init`)

| Directory | Description |
|-----------|-------------|
| `.claude/skills/sqlew-plan-guidance/` | Plan mode quick reference |
| `.claude/skills/sqlew-decision-format/` | Decision format guide |

**Note**: Now managed globally:
- `~/.claude/skills/sqlew-plan-guidance/`
- `~/.claude/skills/plan-decision-format/`

---

## settings.json Modification

Remove hook entries that reference the deleted `.claude/hooks/*.mjs` files.

**Before (v4):**
```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Edit|Write|MultiEdit",
        "hooks": [
          { "command": "node .claude/hooks/check-migration.mjs" },
          { "command": "node .claude/hooks/check-ast-grep.mjs" }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          { "command": "node .claude/hooks/check-db-path.mjs" },
          { "command": "node .claude/hooks/check-prod-db.mjs" }
        ]
      }
    ]
  }
}
```

**After (v5):**
Remove the PreToolUse entries that reference `.claude/hooks/`. The plugin handles these automatically.

---

## Complete File List

Copy-paste ready deletion commands for v4 auto-generated files:

```bash
# Windows (PowerShell)
Remove-Item .claude\agents\parallel-orchestrator.md -ErrorAction SilentlyContinue
Remove-Item .claude\agents\sqlew-architect.md -ErrorAction SilentlyContinue
Remove-Item .claude\agents\sqlew-researcher.md -ErrorAction SilentlyContinue
Remove-Item .claude\agents\sqlew-scrum-master.md -ErrorAction SilentlyContinue
Remove-Item .claude\commands\sqlew.md -ErrorAction SilentlyContinue
Remove-Item .claude\hooks\check-ast-grep.mjs -ErrorAction SilentlyContinue
Remove-Item .claude\hooks\check-db-path.mjs -ErrorAction SilentlyContinue
Remove-Item .claude\hooks\check-migration.mjs -ErrorAction SilentlyContinue
Remove-Item .claude\hooks\check-prod-db.mjs -ErrorAction SilentlyContinue
Remove-Item .claude\rules\plan-mode-integration.md -ErrorAction SilentlyContinue
Remove-Item -Recurse .claude\skills\sqlew-plan-guidance -ErrorAction SilentlyContinue
Remove-Item -Recurse .claude\skills\sqlew-decision-format -ErrorAction SilentlyContinue
```

```bash
# Unix/macOS/Linux
rm -f .claude/agents/parallel-orchestrator.md
rm -f .claude/agents/sqlew-architect.md
rm -f .claude/agents/sqlew-researcher.md
rm -f .claude/agents/sqlew-scrum-master.md
rm -f .claude/commands/sqlew.md
rm -f .claude/hooks/check-ast-grep.mjs
rm -f .claude/hooks/check-db-path.mjs
rm -f .claude/hooks/check-migration.mjs
rm -f .claude/hooks/check-prod-db.mjs
rm -f .claude/rules/plan-mode-integration.md
rm -rf .claude/skills/sqlew-plan-guidance
rm -rf .claude/skills/sqlew-decision-format
```

---

## Verification

After cleanup, verify your setup:

1. **Check plugin is installed:**
   ```bash
   # In Claude Code
   /plugin list
   # Should show: sqlew-plugin@sqlew-plugin
   ```

2. **Check global rules exist:**
   ```bash
   # Windows
   dir %USERPROFILE%\.claude\rules\sqlew\

   # Unix/macOS
   ls ~/.claude/rules/sqlew/
   ```

3. **Test /sqlew command:**
   ```bash
   # In Claude Code
   /sqlew
   # Should show status without errors
   ```

4. **Verify no duplicate hooks:**
   - Open `.claude/settings.json`
   - Ensure no references to `.claude/hooks/*.mjs`

---

## Troubleshooting

### Error: "Cannot find module '.claude/hooks/check-*.mjs'"

**Cause**: `settings.json` still references deleted hook files.

**Solution**: Remove the PreToolUse hooks section from `.claude/settings.json`.

### /sqlew command not found

**Cause**: Plugin not installed or global command not registered.

**Solution**:
```bash
/plugin install sqlew-plugin
# Restart Claude Code
```

### Decisions not being captured automatically

**Cause**: Plugin hooks not active.

**Solution**:
1. Ensure plugin is installed at user level (not project level)
2. Restart Claude Code
3. Check `~/.claude/settings.json` for `enabledPlugins`

---

## Summary

| Category | Files to Delete |
|----------|-----------------|
| **Agents** | `parallel-orchestrator.md`, `sqlew-architect.md`, `sqlew-researcher.md`, `sqlew-scrum-master.md` |
| **Commands** | `sqlew.md` |
| **Hooks** | `check-ast-grep.mjs`, `check-db-path.mjs`, `check-migration.mjs`, `check-prod-db.mjs` |
| **Rules** | `plan-mode-integration.md` |
| **Skills** | `sqlew-plan-guidance/`, `sqlew-decision-format/` |
| **settings.json** | Remove PreToolUse entries referencing `.claude/hooks/` |
