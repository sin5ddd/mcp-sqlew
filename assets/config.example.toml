# sqlew Configuration File
# Copy this file to .sqlew/config.toml and customize as needed
#
# Priority: CLI arguments > config.toml > database m_config > defaults
# Documentation: docs/CONFIGURATION.md

# ============================================================================
# Database Settings
# ============================================================================
[database]
# SQLite Configuration (default, local development)
# Database file path (relative to project root or absolute)
# Default: ".sqlew/sqlew.db"
# path = ".sqlew/custom.db"
# path = "/absolute/path/to/database.db"

# PostgreSQL/MySQL/MariaDB Configuration (multi-agent production)
# Uncomment and configure for remote database access
# type = "postgres"  # or "mysql" (also works with MariaDB 10.5+)

# Connection settings (required for postgres/mysql/mariadb)
# IMPORTANT: Database must already exist! User does NOT need CREATE DATABASE privilege.
# [database.connection]
# host = "localhost"
# port = 5432  # PostgreSQL: 5432, MySQL/MariaDB: 3306
# database = "sqlew"  # Must be created beforehand!

# Authentication settings (required for postgres/mysql/mariadb)
# Required user privileges: SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX, DROP, REFERENCES
# [database.auth]
# type = "direct"  # Options: "direct", "ssh", "aws-iam", "gcp-iam"
# user = "postgres"  # or mysql_user, etc.
# password = "your-password"

# SSL/TLS Configuration (optional, for encrypted connections)
# [database.auth.ssl]
# ca = "/path/to/ca-cert.pem"  # or inline certificate content
# cert = "/path/to/client-cert.pem"  # for mutual TLS
# key = "/path/to/client-key.pem"  # for mutual TLS
# rejectUnauthorized = true  # set to false for self-signed certs (not recommended for production)

# SSH Tunnel Configuration (when type = "ssh")
# Used for bastion host / jump server access
# [database.auth.ssh]
# host = "bastion.example.com"
# port = 22
# username = "deploy"
# privateKeyPath = "/home/user/.ssh/id_rsa"  # or use password
# password = "ssh-password"  # alternative to privateKeyPath
# passphrase = "key-passphrase"  # if private key is encrypted
# timeout = 30000  # SSH connection timeout in ms
# keepalive = true
# keepaliveInterval = 10000
# localPort = 50000  # auto-allocated from 50000-60000 if not specified

# ============================================================================
# Auto-Deletion Settings
# ============================================================================
[autodelete]
# Skip weekends when calculating retention periods
# When true: 24 hours on Monday = previous Friday (skips Sat/Sun)
# When false: 24 hours = exactly 24 hours ago
# Default: false
ignore_weekend = false

# Message retention period in hours (1-720)
# Messages older than this are automatically deleted
# Default: 24 (1 day)
message_hours = 24

# File change history retention in days (1-365)
# File changes older than this are automatically deleted
# Default: 7 (1 week)
file_history_days = 7

# ============================================================================
# Debug Logging Settings (v3.5.4)
# ============================================================================
[debug]
# Debug log file path (optional)
# When set, enables detailed debug logging for troubleshooting
# Environment variable SQLEW_DEBUG takes precedence over this setting
# Default: not set (logging disabled)
# log_path = "/home/user/.sqlew/debug.log"
# log_path = ".sqlew/debug.log"

# Log level for debug output (case-insensitive)
# Levels: "error", "warn", "info", "debug"
# error: Only errors
# warn: Errors and warnings
# info: Errors, warnings, and informational messages
# debug: All messages including debug details
# Default: "info"
# log_level = "info"

# ============================================================================
# Task Management Settings
# ============================================================================
[tasks]
# Auto-archive done tasks after N days (1-365)
# Tasks in 'done' status older than this are moved to 'archived'
# Keeps task list clean while preserving history
# Default: 2 (48 hours)
auto_archive_done_days = 2

# Stale detection threshold for 'in_progress' tasks (hours, 1-168)
# Tasks stuck in 'in_progress' longer than this → move to 'waiting_review'
# Helps recover from interrupted AI sessions
# Default: 2 (2 hours)
stale_hours_in_progress = 2

# Stale detection threshold for 'waiting_review' tasks (hours, 1-720)
# Tasks stuck in 'waiting_review' longer than this → move back to 'todo'
# Prevents abandoned reviews from blocking workflow
# Default: 24 (1 day)
stale_hours_waiting_review = 24

# Enable automatic stale detection
# When true: Runs stale detection on startup and before task operations
# When false: Stale detection disabled (manual only)
# Default: true
auto_stale_enabled = true

# ============================================================================
# VCS-Aware Auto-Complete Settings (v3.5.2)
# ============================================================================
[vcs]
# Auto-complete tasks when files are staged (git add)
# When true: waiting_review → done when files are staged
# When false: Manual task completion required
# Default: true
git_auto_complete_on_stage = true

# Auto-archive tasks when files are committed (git commit)
# When true: done → archived when files are committed
# When false: Manual task archiving required
# Default: true
git_auto_archive_on_commit = true

# Require ALL watched files to be staged for auto-completion
# When true: All files must be staged to trigger waiting_review → done
# When false: At least one file staged is sufficient
# Default: true
require_all_files_staged = true

# Require ALL watched files to be committed for auto-archiving
# When true: All files must be committed to trigger done → archived
# When false: At least one file committed is sufficient
# Default: true
require_all_files_committed_for_archive = true

# ============================================================================
# Specialized Agents Settings
# ============================================================================
[agents]
# Which specialized agents to enable for your project
# Set to false to skip agents you don't need (reduces token consumption)
# Install by manually copying files from assets/sample-agents/ to ~/.claude/agents/
# Note: Agents are only loaded into Claude Code conversations, not the MCP server

# Scrum Master: Multi-agent coordination, task management, sprint planning
# Token cost: ~12KB per conversation when loaded in Claude Code
# Use when: Coordinating complex features, managing dependencies, tracking progress
# Default: true
scrum_master = true

# Researcher: Query decisions, analyze patterns, investigate context
# Token cost: ~14KB per conversation when loaded in Claude Code
# Use when: Understanding past decisions, onboarding new members, sprint retrospectives
# Default: true
researcher = true

# Architect: Document decisions, enforce constraints, maintain standards
# Token cost: ~20KB per conversation when loaded in Claude Code
# Use when: Making architectural choices, establishing rules, validating compliance
# Default: true
architect = true

# Example: Minimal installation (only Scrum Master for task management)
# [agents]
# scrum_master = true
# researcher = false
# architect = false

# Token Impact Examples:
# - All 3 agents: ~46KB loaded per conversation (scrum 12KB + researcher 14KB + architect 20KB)
# - Scrum + Architect: ~32KB (30% reduction)
# - Scrum only: ~12KB (74% reduction)


# ============================================================================
# Slash Commands Settings
# ============================================================================
[commands]
# Which slash commands to install on server startup
# Set to false to skip commands you don't need

# /sqlew: Unified natural language interface for decisions and tasks
# Usage: /sqlew <what you want to do>
# Examples:
#   /sqlew show remaining tasks
#   /sqlew search for auth decisions
#   /sqlew record that we use PostgreSQL 15
# Default: true
sqlew = true

# ============================================================================
# Example Configurations
# ============================================================================

# Example 1: PostgreSQL with Direct Authentication + SSL
# [database]
# type = "postgres"
# [database.connection]
# host = "db.example.com"
# port = 5432
# database = "sqlew_production"
# [database.auth]
# type = "direct"
# user = "postgres"
# password = "secure-password"
# [database.auth.ssl]
# ca = "/path/to/ca-cert.pem"
# rejectUnauthorized = true

# Example 2: PostgreSQL through SSH Tunnel
# [database]
# type = "postgres"
# [database.connection]
# host = "db.internal.example.com"
# port = 5432
# database = "sqlew_production"
# [database.auth]
# type = "ssh"
# user = "postgres"
# password = "db-password"
# [database.auth.ssh]
# host = "bastion.example.com"
# username = "deploy"
# privateKeyPath = "/home/user/.ssh/id_rsa"

# Example 3: MySQL with SSL and SSH
# [database]
# type = "mysql"
# [database.connection]
# host = "mysql.internal.example.com"
# port = 3306
# database = "sqlew_db"
# [database.auth]
# type = "ssh"
# user = "mysql_user"
# password = "db-password"
# [database.auth.ssl]
# ca = "-----BEGIN CERTIFICATE-----\nMIIE...\n-----END CERTIFICATE-----"
# rejectUnauthorized = true
# [database.auth.ssh]
# host = "jump.example.com"
# port = 22
# username = "deploy"
# privateKeyPath = "/home/user/.ssh/deploy_key"
# passphrase = "key-passphrase"
# localPort = 53306

# Aggressive cleanup (development)
# [autodelete]
# message_hours = 1
# file_history_days = 1
# [tasks]
# auto_archive_done_days = 1

# Conservative cleanup (production)
# [autodelete]
# message_hours = 168  # 7 days
# file_history_days = 30
# [tasks]
# auto_archive_done_days = 7

# Weekend-aware workflow (for developers)
# [autodelete]
# ignore_weekend = true
# message_hours = 48
# file_history_days = 14
